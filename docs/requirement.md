# 产品需求文档（PRD）

## 个人助手 - v1.0

---

## 📋 文档信息

| 项目           | 内容       |
| -------------- | ---------- |
| **产品名称**   | 个人助手   |
| **文档版本**   | v1.1.0     |
| **创建日期**   | 2025-01-18 |
| **最后更新**   | 2025-01-18 |
| **产品经理**   | [待填写]   |
| **研发负责人** | [待填写]   |
| **UI设计师**   | [待填写]   |
| **测试负责人** | [待填写]   |
| **文档状态**   | 评审中     |

### 版本修订历史

| 版本号 | 修订日期   | 修订人 | 修订内容               | 状态   |
| ------ | ---------- | ------ | ---------------------- | ------ |
| v1.0.0 | 2025-01-18 | -      | 初始版本创建           | 初稿   |
| v1.1.0 | 2025-01-18 | -      | 整合用户故事与功能分级 | 评审中 |

---

## 📌 目录

1. [项目背景与目标](#1-项目背景与目标)
2. [用户角色与使用场景](#2-用户角色与使用场景)
3. [核心功能需求](#3-核心功能需求)
4. [非功能需求](#4-非功能需求)
5. [交互设计规范](#5-交互设计规范)
6. [技术架构说明](#6-技术架构说明)
7. [接口文档](#7-接口文档)
8. [数据埋点需求](#8-数据埋点需求)
9. [测试验收标准](#9-测试验收标准)
10. [上线计划](#10-上线计划)
11. [风险评估与应对](#11-风险评估与应对)

---

## 1. 项目背景与目标

### 1.1 项目背景

当前，教育机构中的算法教学管理面临以下痛点：

- **管理成本高**：教师需要手动记录和跟踪每位学生在洛谷、力扣等OJ平台的刷题进度
- **数据获取难**：教师需要逐个访问学生的OJ主页查看完成情况，效率低下
- **进度可视化差**：缺乏直观的排行榜和进度展示，无法快速了解整体情况
- **激励机制不足**：学生之间缺乏良性竞争氛围，学习动力不足

### 1.2 项目目标

**短期目标**（MVP版本）：

- 支持学生绑定洛谷、力扣账号，自动获取刷题数据
- 提供直观的排行榜展示，激励学生刷题
- 提供优美的视觉体验，提升用户留存率

**长期目标**：

- 支持教师布置算法作业，自动检查完成情况
- 提供详细的数据分析报告，追踪学生成长轨迹
- 构建算法学习社区，促进学生交流

### 1.3 核心价值

| 维度       | 价值说明                                |
| ---------- | --------------------------------------- |
| **对教师** | 降低管理成本 80%+，实时掌握全班学习进度 |
| **对学生** | 可视化学习成果，增强学习动力和竞争意识  |
| **对机构** | 提升教学管理效率，沉淀教学数据资产      |

---

## 2. 用户角色与使用场景

### 2.1 用户角色定义

#### 角色1：学生（Student）

**基本信息**：

- **年龄**：18-22岁
- **身份**：高校计算机专业学生
- **技术水平**：具备基本编程能力，熟悉1-2门编程语言
- **使用场景**：日常刷题练习、课程作业、算法竞赛准备

**核心诉求**：

- 了解自己的刷题进度和排名
- 与同学进行良性竞争
- 获得成就感和激励

**痛点**：

- 不知道自己在班级中的水平
- 缺乏学习动力和目标
- 无法直观看到自己的进步

**使用频率**：高（每天2-3次）

---

#### 角色2：教师/管理员（Teacher/Admin）

**基本信息**：

- **年龄**：30-45岁
- **身份**：高校教师、培训机构讲师
- **技术水平**：熟悉编程，有一定管理经验
- **使用场景**：布置作业、检查进度、数据分析

**核心诉求**：

- 快速了解全班学习进度
- 发现学习困难的学生
- 评估教学效果
- 督促学生算法学习

**痛点**：

- 手动记录和管理成本高
- 无法实时掌握学生进度
- 缺乏数据支撑的教学决策

**使用频率**：中（每天1次）

> **注**：V1.0版本暂不实现教师端功能，在V2.0中规划

---

### 2.2 用户画像（Persona）

#### 学生用户 - 张三

```
姓名：张三
年龄：20岁
学校：某某大学计算机系
年级：大二
专业：计算机科学与技术

技术背景：
- 熟悉Python、C++
- 在洛谷平台做了200道题
- 在力扣平台做了50道题

刷题习惯：
- 每天晚上刷1-2小时题
- 喜欢做动态规划和图论题
- 偶尔会查看排行榜

期望：
- 能够看到自己在班级的排名
- 了解自己和同学的差距
- 通过排名激励自己继续刷题

痛点：
- 不知道班级其他同学刷了多少题
- 缺乏竞争氛围，学习动力不足
- 无法量化自己的进步
```

---

### 2.3 用户故事（User Stories）

#### US-001: 用户注册

**用户故事**：

> 作为一个新学生，我希望能够通过手机号注册账号，以便于我开始使用这个平台。

**优先级**：P0（必须有）

**验收标准**：

```gherkin
Scenario 1: 正常注册
  Given 我访问注册页面
  And 我没有注册过账号
  When 我输入用户名"张三"
  And 我输入手机号"13800138000"
  And 我输入密码"pass1234"
  And 我输入6位验证码
  And 我点击"注册"按钮
  Then 注册成功
  And 手动登录系统
  And 跳转到主页
  And 收到JWT Token

Scenario 2: 手机号重复
  Given 我访问注册页面
  And 手机号"13800138000"已被注册
  When 我输入相同的手机号
  And 我点击"注册"按钮
  Then 注册失败
  And 提示"手机号已注册"

Scenario 3: 验证码错误
  Given 我访问注册页面
  When 我输入所有信息
  And 我输入错误的验证码
  And 我点击"注册"按钮
  Then 注册失败
  And 提示"验证码错误"

Scenario 4: 密码格式错误
  Given 我访问注册页面
  When 我输入所有信息
  And 我输入密码"123"（少于8位）
  And 我点击"注册"按钮
  Then 注册失败
  And 提示"密码长度必须为8-16位"
```

---

#### US-002: 用户登录

**用户故事**：

> 作为一个已注册的学生，我希望能够使用手机号和密码登录，以便于我进入平台查看排行榜。

**优先级**：P0（必须有）

**验收标准**：

```gherkin
Scenario 1: 正常登录
  Given 我已注册账号
  And 手机号为"13800138000"
  And 密码为"pass1234"
  When 我访问登录页面
  And 我输入手机号和密码
  And 我输入正确的验证码
  And 我点击"登录"按钮
  Then 登录成功
  And 跳转到主页
  And 收到JWT Token
  And 收到RefreshToken（Cookie）

Scenario 2: 密码错误
  Given 我已注册账号
  When 我输入正确的手机号
  And 我输入错误的密码
  And 我点击"登录"按钮
  Then 登录失败
  And 提示"密码错误"
  And 连续错误5次后锁定账号30分钟

Scenario 3: 账号不存在
  Given 我访问登录页面
  When 我输入未注册的手机号
  And 我点击"登录"按钮
  Then 登录失败
  And 提示"账号不存在"

Scenario 4: Token刷新
  Given 我已登录
  And AccessToken已过期（2小时后）
  When 我访问需要认证的接口
  Then 系统自动调用刷新接口
  And 返回新的AccessToken
  And 用户无感知
```

---

#### US-003: 用户登出

**用户故事**：

> 作为一个已登录的学生，我希望能够退出登录，以便于保护我的账号安全。

**优先级**：P0（必须有）

**验收标准**：

```gherkin
Scenario 1: 正常登出
  Given 我已登录
  When 我点击顶部用户图标
  And 我点击"退出登录"按钮
  Then 登出成功
  And 清除本地Token
  And 清除服务端登录状态
  And RefreshToken加入黑名单
  And 跳转到登录页
```

---

#### US-004: 获取验证码

**用户故事**：

> 作为一个用户，我希望能够获取图形验证码，以便于防止机器人恶意注册。

**优先级**：P0（必须有）

**验收标准**：

```gherkin
Scenario 1: 获取验证码
  Given 我访问注册或登录页面
  When 页面加载完成
  Then 自动显示图形验证码
  And 验证码为6位数字
  And 验证码图片清晰可辨认
  And 返回验证码ID

Scenario 2: 验证码刷新
  Given 我看到验证码
  When 我点击验证码图片
  Then 验证码刷新
  And 生成新的验证码ID
```

---

#### US-005: 绑定洛谷账号

**用户故事**：

> 作为一个学生，我希望能够绑定我的洛谷账号，以便于系统自动获取我的刷题数据。

**优先级**：P1（应该有）

**验收标准**：

```gherkin
Scenario 1: 成功绑定洛谷账号
  Given 我已登录
  And 我还没有绑定洛谷账号
  When 我进入主页
  And 我在"洛谷卡片"输入框输入洛谷ID"123456"
  And 我点击"提交"按钮
  Then 系统验证ID有效性
  And 验证通过后
  And 卡片翻转到反面
  And 显示我的头像
  And 显示我的真实姓名
  And 显示我通过的题目数量
  And 显示简单/中等/困难题目数量

Scenario 2: ID不存在
  Given 我已登录
  When 我输入不存在的洛谷ID"999999"
  And 我点击"提交"按钮
  Then 绑定失败
  And 提示"ID无效，请检查后重试"
  And 卡片不翻转

Scenario 3: 网络超时
  Given 我已登录
  When 我输入洛谷ID
  And 我点击"提交"按钮
  And 后端爬虫请求超时（>10秒）
  Then 绑定失败
  And 提示"服务繁忙，请稍后重试"
  And 卡片不翻转

Scenario 4: 修改已绑定的ID
  Given 我已绑定洛谷ID"123456"
  And 卡片处于反面状态
  When 我点击"修改"按钮
  Then 卡片翻转到正面
  And 输入框显示当前ID
  And 我可以修改ID
  And 重新提交后更新数据
```

---

#### US-006: 绑定力扣账号

**用户故事**：

> 作为一个学生，我希望能够绑定我的力扣账号，以便于系统自动获取我的刷题数据。

**优先级**：P1（应该有）

**验收标准**：

```gherkin
Scenario 1: 成功绑定力扣账号
  Given 我已登录
  And 我还没有绑定力扣账号
  When 我进入主页
  And 我在"力扣卡片"输入框输入力扣ID"user123"
  And 我点击"提交"按钮
  Then 系统验证ID有效性
  And 验证通过后
  And 卡片翻转到反面
  And 显示我的头像
  And 显示我的真实姓名
  And 显示我通过的题目数量
```

---

#### US-007: 查看排行榜

**用户故事**：

> 作为一个学生，我希望看到洛谷/力扣排行榜，以便于了解自己在班级中的排名。

**优先级**：P1（应该有）

**验收标准**：

```gherkin
Scenario 1: 查看排行榜（有数据）
  Given 我已登录
  And 我已绑定洛谷账号
  And 组织内至少有1个学生绑定了洛谷
  When 我进入主页
  And 我查看右侧排行榜卡片
  Then 显示洛谷排行榜
  And 排行榜按通过题目数降序排列
  And 只显示前60%的学生
  And 每个学生显示：排名、头像、真实姓名、通过题目数
  And 我的排名高亮显示

Scenario 2: 查看排行榜（无数据）
  Given 我已登录
  And 我还没有绑定洛谷账号
  When 我查看排行榜卡片
  Then 提示"请先绑定洛谷账号才能查看排行榜"

Scenario 3: 排行榜为空
  Given 我已登录
  And 我已绑定洛谷账号
  And 组织内没有其他学生绑定洛谷
  When 我查看排行榜卡片
  Then 显示"暂无排行数据"

Scenario 4: 切换到力扣排行榜
  Given 我正在查看洛谷排行榜
  When 我点击排行榜卡片
  Then 卡片翻转到反面
  And 显示力扣排行榜
```

---

#### US-008: 查看个人数据卡片

**用户故事**：

> 作为一个学生，我希望能够查看我的个人刷题数据，以便于了解我的学习进度。

**优先级**：P1（应该有）

**验收标准**：

```gherkin
Scenario 1: 查看洛谷个人数据
  Given 我已登录
  And 我已绑定洛谷账号
  When 我进入主页
  And 我查看左上角"洛谷卡片"
  Then 卡片处于反面状态
  And 显示我的头像（80×80px，圆形）
  And 显示我的真实姓名
  And 显示我通过的题目总数
  And 显示简单/中等/困难题目数量

Scenario 2: 卡片翻转动画
  Given 我的洛谷卡片处于正面状态
  When 我提交洛谷ID成功
  Then 卡片执行3D翻转动画
  And 动画时长600ms
  And 使用ease-in-out缓动函数
  And 翻转到反面显示个人数据

Scenario 3: 修改洛谷ID
  Given 我的洛谷卡片处于反面状态
  When 我点击"修改"按钮
  Then 卡片翻转到正面
  And 输入框显示当前ID
  And 我可以修改ID
```

---

#### US-009: 查看组织列表

**用户故事**：

> 作为一个注册学生，我希望能够查看可用的组织列表，以便于我选择加入合适的组织。

**优先级**：P2（可以有）

**验收标准**：

```gherkin
Scenario 1: 查看组织列表（分页）
  Given 我访问注册页面
  When 我点击"选择组织"下拉框
  Then 显示组织列表
  And 每页显示10个组织
  And 显示组织名称和描述
  And 我可以翻页查看更多

Scenario 2: 查看组织列表（全部）
  Given 我访问注册页面
  When 我不传page参数
  Then 显示所有组织

Scenario 3: 搜索组织
  Given 我访问注册页面
  When 我输入"清华"
  Then 显示名称包含"清华"的组织
```

---

### 2.4 用户故事地图

将用户故事按照使用流程排列，形成故事地图：

```
【阶段1：发现与注册】
  访问平台 → 查看轮播图 → 了解平台功能 → 注册账号（US-001）★ P0

【阶段2：登录认证】
  获取验证码（US-004）★ P0 → 输入手机号密码 → 提交登录
  → 接收Token → 进入主页（US-002）★ P0

【阶段3：绑定OJ账号】
  查看个人卡片 → 输入洛谷ID → 绑定洛谷账号（US-005）★ P1
  → 输入力扣ID → 绑定力扣账号（US-006）★ P1
  → 查看个人数据（US-008）★ P1

【阶段4：查看排行榜】
  查看洛谷排行榜（US-007）★ P1 → 查看力扣排行榜（US-007）★ P1
  → 切换排行榜 → 对比自己排名

【阶段5：持续使用】
  每日登录（US-002）★ P0 → 查看排名变化 → 刷题后查看更新
  → 修改绑定ID（US-005）★ P1 → 退出登录（US-003）★ P0

【阶段6：辅助功能】
  选择组织（US-009）☆ P2 → 查看组织列表

图例：★ 必须实现 | ☆ 可选实现
```

---

## 3. 核心功能需求

### 3.1 功能模块总览

```
个人助手 v1.0
├── 用户认证模块
│   ├── 用户注册
│   ├── 用户登录
│   ├── 验证码生成
│   ├── Token刷新
│   └── 用户登出
├── OJ账号绑定模块
│   ├── 洛谷账号绑定
│   ├── 力扣账号绑定
│   └── 账号信息展示
├── 排行榜模块
│   ├── 洛谷排行榜
│   ├── 力扣排行榜
│   └── 个人数据卡片
└── 组织管理模块
    └── 组织列表查询
```

---

### 3.2 功能分级（MoSCoW Method）

#### P0：必须有（Must Have）- 5个功能

| 功能ID   | 功能名称   | 功能描述                   | 不做的影响   |
| -------- | ---------- | -------------------------- | ------------ |
| **F001** | 用户注册   | 新用户通过手机号注册账号   | 无法获取用户 |
| **F002** | 用户登录   | 已注册用户通过手机号登录   | 无法使用系统 |
| **F003** | 验证码生成 | 生成图形验证码，防止机器人 | 存在安全风险 |
| **F004** | Token刷新  | AccessToken过期后自动刷新  | 用户体验极差 |
| **F005** | 用户登出   | 用户主动退出登录           | 无法安全退出 |

**开发排期**：Week 1-2（必须100%完成）

---

#### P1：应该有（Should Have）- 6个功能

| 功能ID   | 功能名称     | 功能描述                         | 价值         |
| -------- | ------------ | -------------------------------- | ------------ |
| **F101** | 绑定洛谷账号 | 用户绑定洛谷ID，自动获取刷题数据 | 核心业务功能 |
| **F102** | 绑定力扣账号 | 用户绑定力扣ID，自动获取刷题数据 | 核心业务功能 |
| **F103** | 个人数据卡片 | 展示用户在洛谷/力扣的个人数据    | 核心展示功能 |
| **F104** | 洛谷排行榜   | 展示组织的洛谷刷题排行榜         | 核心展示功能 |
| **F105** | 力扣排行榜   | 展示组织的力扣刷题排行榜         | 核心展示功能 |
| **F106** | 卡片翻转动画 | 绑定成功后卡片自动翻转           | 提升体验     |

**开发排期**：Week 2-3（至少完成80%）

---

#### P2：可以有（Could Have）- 4个功能

| 功能ID   | 功能名称     | 功能描述                   | 价值       |
| -------- | ------------ | -------------------------- | ---------- |
| **F201** | 组织列表查询 | 用户注册时查看可加入的组织 | 辅助功能   |
| **F202** | 排行榜搜索   | 在排行榜中搜索特定用户     | 便利性提升 |
| **F203** | 刷新排行榜   | 手动刷新排行榜数据         | 便利性提升 |
| **F204** | 数据统计图表 | 用图表展示刷题趋势         | 可视化增强 |

**开发排期**：Week 4（时间充裕则做）

---

#### P3：本次不做（Won't Have - V2.0规划）- 7个功能

| 功能ID   | 功能名称   | 功能描述               | 规划版本 |
| -------- | ---------- | ---------------------- | -------- |
| **F301** | 管理员后台 | 教师管理学生、查看数据 | V2.0     |
| **F302** | 作业布置   | 教师布置算法作业       | V2.0     |
| **F303** | 进度检查   | 自动检查作业完成情况   | V2.0     |
| **F304** | 移动端适配 | 支持手机和平板访问     | V2.0     |
| **F305** | 社交功能   | 学生之间交流讨论       | V2.0     |
| **F306** | 成就系统   | 勋章、等级、积分       | V2.0     |
| **F307** | 数据导出   | 导出学习报告           | V2.0     |

**规划版本**：V2.0（3个月后）

---

### 3.3 功能依赖关系图

#### 依赖关系矩阵

| 功能              | F001注册 | F002登录 | F004刷新 | F005洛谷 | F007排行 | F009组织 |
| ----------------- | -------- | -------- | -------- | -------- | -------- | -------- |
| **F001 注册**     | -        | -        | -        | -        | -        | ○        |
| **F002 登录**     | ●        | -        | -        | -        | -        | -        |
| **F003 验证码**   | ●        | ●        | -        | -        | -        | -        |
| **F004 刷新**     | ●        | ●        | -        | -        | -        | -        |
| **F005 洛谷**     | ●        | ●        | ●        | -        | -        | -        |
| **F006 力扣**     | ●        | ●        | ●        | ○        | -        | -        |
| **F007 排行榜**   | ●        | ●        | ●        | ●        | -        | -        |
| **F008 个人卡片** | ●        | ●        | ●        | ●        | ○        | -        |
| **F009 组织**     | ○        | -        | -        | -        | -        | -        |

图例：● 强依赖 | ○ 弱依赖 | - 无依赖

---

#### 开发顺序建议

基于依赖关系，建议的开发顺序：

```
第1周（P0功能）：
  Day 1-2: 验证码生成（F003）
  Day 3-4: 用户注册（F001）
  Day 5-7: 用户登录 + Token刷新（F002 + F004）

第2周（P1功能）：
  Day 1-3: 绑定洛谷账号（F005）
  Day 4-5: 个人数据卡片（F008）
  Day 6-7: 洛谷排行榜（F007）

第3周（P1/P2功能）：
  Day 1-2: 绑定力扣账号（F006）
  Day 3-4: 力扣排行榜（F007）
  Day 5-7: 组织列表查询（F009）+ 联调测试

第4周（测试优化）：
  Day 1-3: 全面测试
  Day 4-5: Bug修复
  Day 6-7: 性能优化 + 上线准备
```

---

### 3.4 功能详细说明

由于功能详细说明较为冗长，已整合到用户故事中（第2.3节）。每个用户故事都包含：

- 功能描述
- 输入参数
- 业务规则
- 验收标准

---

## 4. 非功能需求

### 4.1 性能需求

| 指标             | 目标值         | 测量方法                |
| ---------------- | -------------- | ----------------------- |
| **首页加载时间** | ≤2秒           | Chrome DevTools Network |
| **API响应时间**  | ≤500ms (P95)   | 后端监控系统            |
| **排行榜刷新**   | ≤1秒           | 前端性能监控            |
| **并发用户数**   | ≥500人同时在线 | 压力测试                |
| **OJ数据爬取**   | ≤10秒/次       | 后端日志                |

### 4.2 安全需求

| 安全项       | 具体措施                              |
| ------------ | ------------------------------------- |
| **密码安全** | BCrypt哈希，盐值加密存储              |
| **传输加密** | 全站HTTPS（生产环境）                 |
| **防刷攻击** | 图形验证码 + IP限流（5次/分钟）       |
| **XSS防护**  | 前端输入过滤 + 后端转义               |
| **CSRF防护** | SameSite Cookie + CSRF Token          |
| **SQL注入**  | ORM框架 + 参数化查询                  |
| **JWT安全**  | 短期Token + RefreshToken + 黑名单机制 |

### 4.3 兼容性需求

#### 浏览器兼容

| 浏览器  | 最低版本 | 说明     |
| ------- | -------- | -------- |
| Chrome  | ≥90      | 主要支持 |
| Edge    | ≥90      | 主要支持 |
| Safari  | ≥14      | 主要支持 |
| Firefox | ≥88      | 主要支持 |
| IE      | -        | 不支持   |

#### 设备兼容

| 设备类型 | 分辨率    | 说明     |
| -------- | --------- | -------- |
| PC端     | ≥1366×768 | 主要支持 |
| 平板     | 768×1024  | 部分支持 |
| 手机     | -         | 暂不支持 |

### 4.4 可用性需求

| 指标           | 目标值 | 说明            |
| -------------- | ------ | --------------- |
| **系统可用性** | ≥99.5% | 月度统计        |
| **数据准确性** | 100%   | OJ数据必须准确  |
| **错误率**     | ≤0.1%  | API错误请求占比 |

### 4.5 可维护性需求

- 代码注释率 ≥30%
- 关键业务逻辑单元测试覆盖率 ≥80%
- 接口文档自动生成（Swagger）
- 日志完整性（请求日志、错误日志、业务日志）

---

## 5. 交互设计规范

### 5.1 整体布局

#### 版心设计

- **版心宽度**：1200px（PC端）
- **对齐方式**：水平居中

#### 页面结构（登录后）

```
┌─────────────────────────────────────────┐
│  [顶部触发按钮]                         │
├─────────────────────────────────────────┤
│  Header Bar（默认隐藏，悬浮显示）       │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ │
│  欢迎来到算法平台          [用户图标▼]  │
└─────────────────────────────────────────┘
│                                          │
│  ┌────────────┬────────────────────────┐│
│  │            │                        ││
│  │ 洛谷卡片   │                        ││
│  │            │                        ││
│  ├────────────┤                        ││
│  │            │    排行榜卡片          ││
│  │ 力扣卡片   │                        ││
│  │            │                        ││
│  └────────────┴────────────────────────┘│
│                                          │
└─────────────────────────────────────────┘
```

### 5.2 视觉设计规范

#### 主题色调

| 颜色用途   | 色值             | 说明             |
| ---------- | ---------------- | ---------------- |
| **主色调** | `#1890FF` (蓝色) | 品牌、按钮、链接 |
| **辅助色** | `#52C41A` (绿色) | 成功、通过       |
| **辅助色** | `#FAAD14` (橙色) | 警告、提示       |
| **辅助色** | `#F5222D` (红色) | 错误、失败       |
| **中性色** | `#FFFFFF` (白色) | 背景、卡片       |
| **中性色** | `#FAFAFA` (浅灰) | 背景、分区       |
| **中性色** | `#000000` (黑色) | 文字、边框       |

#### 字体规范

| 应用场景     | 字体        | 大小 | 字重    |
| ------------ | ----------- | ---- | ------- |
| **标题**     | PingFang SC | 24px | Medium  |
| **副标题**   | PingFang SC | 18px | Regular |
| **正文**     | PingFang SC | 14px | Regular |
| **辅助文字** | PingFang SC | 12px | Regular |

#### 圆角规范

| 组件类型   | 圆角大小 |
| ---------- | -------- |
| **登录框** | 16px     |
| **卡片**   | 12px     |
| **按钮**   | 6px      |
| **输入框** | 6px      |

### 5.3 交互细节

#### 轮播背景（未登录）

- **自动轮播**：4秒切换一次
- **切换效果**：淡入淡出（opacity: 1 → 0 → 1）
- **去除按钮**：无左右切换箭头
- **图片要求**：尺寸1920×1080px，格式JPG/WebP，大小≤500KB/张

#### 登录注册框

- **位置**：页面垂直水平居中
- **尺寸**：400×500px
- **背景**：白色 + 85%不透明度
- **圆角**：16px
- **阴影**：`0 8px 32px rgba(0,0,0,0.1)`

#### Header Bar

- **初始状态**：完全隐藏
- **触发方式**：顶部居中悬浮一个小按钮（24×24px圆形）
- **显示动画**：从顶部滑入，300ms，ease-out
- **高度**：60px

#### 卡片翻转

- **翻转触发**：绑定OJ账号成功后自动翻转
- **翻转效果**：CSS 3D Transform，600ms，ease-in-out
- **卡片尺寸**：左侧卡片580×280px，右侧卡片580×580px
- **卡片间距**：20px

#### 排行榜卡片

- **正面**：洛谷排行榜
- **反面**：力扣排行榜
- **切换方式**：点击卡片切换
- **列表项高度**：60px

### 5.4 动画规范

| 动画类型      | 时长   | 缓动函数    | 说明          |
| ------------- | ------ | ----------- | ------------- |
| **页面切换**  | 300ms  | ease-out    | 登录 → 主页   |
| **卡片翻转**  | 600ms  | ease-in-out | 3D翻转效果    |
| **按钮hover** | 200ms  | ease-in-out | 背景色变化    |
| **下拉菜单**  | 200ms  | ease-out    | 菜单展开/收起 |
| **轮播切换**  | 1000ms | linear      | 淡入淡出      |

---

## 6. 技术架构说明

### 6.1 整体架构

```
┌─────────────────────────────────────────────────┐
│                   前端层                        │
│  React 18 + TypeScript + Ant Design + Tailwind  │
└───────────────────┬─────────────────────────────┘
                    │ HTTP/WebSocket
┌───────────────────▼─────────────────────────────┐
│                   网关层                        │
│               Nginx (反向代理)                  │
└───────────────────┬─────────────────────────────┘
                    │
┌───────────────────▼─────────────────────────────┐
│                 后端服务层                      │
│         Go + Gin + Clean Architecture          │
│  ┌──────────┬──────────┬──────────┬─────────┐ │
│  │Controller│  Service │Repository│  Model  │ │
│  └──────────┴──────────┴──────────┴─────────┘ │
└─────┬──────────────────────┬────────────────────┘
      │                      │
┌─────▼──────┐      ┌───────▼────────┐
│   MySQL    │      │     Redis      │
│  (数据存储) │      │  (缓存/会话)   │
└────────────┘      └────────────────┘
```

### 6.2 前端技术栈

| 技术             | 版本 | 用途         |
| ---------------- | ---- | ------------ |
| **React**        | 18.x | 前端框架     |
| **TypeScript**   | 5.x  | 类型安全     |
| **Vite**         | 5.x  | 构建工具     |
| **Ant Design**   | 5.x  | UI组件库     |
| **Tailwind CSS** | 3.x  | 原子化CSS    |
| **React Router** | 6.x  | 路由管理     |
| **Axios**        | 1.x  | HTTP客户端   |
| **Zustand**      | 4.x  | 状态管理     |
| **React Query**  | 5.x  | 数据请求缓存 |

### 6.3 后端技术栈

| 技术              | 版本   | 用途      |
| ----------------- | ------ | --------- |
| **Go**            | 1.21+  | 后端语言  |
| **Gin**           | 1.11.0 | Web框架   |
| **GORM**          | 1.31.0 | ORM框架   |
| **JWT**           | 4.5.2  | 认证授权  |
| **Casbin**        | 2.11.0 | 权限控制  |
| **Redis**         | 8.11.5 | 缓存/会话 |
| **MySQL**         | 8.0+   | 数据库    |
| **Elasticsearch** | 8.19.0 | 搜索引擎  |
| **Zap**           | 1.27.0 | 日志系统  |
| **Colly**         | latest | 爬虫框架  |

---

## 7. 接口文档

### 7.1 接口基础信息

**基础URL**: `http://localhost:8080` (开发环境)

**统一响应格式**:

```json
{
  "code": 200,
  "message": "操作成功",
  "data": {}
}
```

**认证方式**:

- AccessToken: 放在HTTP Header中 `Authorization: Bearer <token>`
- RefreshToken: 自动存储在HttpOnly Cookie中

### 7.2 公共接口（无需认证）

#### 7.2.1 获取验证码

**接口路径**: `POST /base/captcha`

**接口作用**: 生成图形验证码

**请求参数**: 无

**返回示例**:

```json
{
  "code": 200,
  "message": "验证码生成成功",
  "data": {
    "captcha_id": "captcha-20250118-abc123",
    "pic_path": "data:image/png;base64,iVBORw0KGgo..."
  }
}
```

#### 7.2.2 用户注册

**接口路径**: `POST /user/register`

**接口作用**: 新用户注册

**请求参数**:

```json
{
  "username": "张三",
  "password": "pass1234",
  "phone": "13800138000",
  "captcha": "123456",
  "captcha_id": "captcha-20250118-abc123",
  "org_id": 1
}
```

**返回示例**:

```json
{
  "code": 200,
  "message": "登录成功",
  "data": {
    "user": { ... },
    "access_token": "eyJhbGciOiJIUzI1NiIs...",
    "access_token_expires_at": 1737182400000
  }
}
```

#### 7.2.3 用户登录

**接口路径**: `POST /user/login`

**接口作用**: 用户登录

**请求参数**:

```json
{
  "phone": "13800138000",
  "password": "pass1234",
  "captcha": "234567",
  "captcha_id": "captcha-20250118-def456"
}
```

**返回示例**: 同注册接口

#### 7.2.4 获取组织列表

**接口路径**: `GET /org/list?page=1&page_size=10`

**接口作用**: 查询组织列表

#### 7.2.5 刷新Token

**接口路径**: `GET /refreshToken`

**接口作用**: 刷新AccessToken

**请求参数**: RefreshToken从Cookie自动获取

### 7.3 业务接口（需要JWT认证）

#### 7.3.1 用户登出

**接口路径**: `POST /user/logout`

**接口作用**: 退出登录

**请求头**: `Authorization: Bearer <token>`

#### 7.3.2 绑定OJ账号

**接口路径**: `POST /oj/bind`

**接口作用**: 绑定洛谷或力扣账号

**请求参数**:

```json
{
  "platform": "luogu",
  "identifier": "123456"
}
```

**返回示例**:

```json
{
  "code": 200,
  "message": "绑定成功",
  "data": {
    "platform": "luogu",
    "identifier": "123456",
    "real_name": "张三",
    "user_avatar": "https://cdn.luogu.com.cn/avatar/123456.jpg",
    "passed_number": 150,
    "easy_number": 50,
    "medium_number": 70,
    "hard_number": 30,
    "total_number": 150
  }
}
```

### 7.4 错误码说明

| 错误码 | 说明           | 示例场景             |
| ------ | -------------- | -------------------- |
| 200    | 成功           | 请求正常处理         |
| 400    | 请求参数错误   | 验证码错误、参数缺失 |
| 4010   | 未授权         | Token过期、Token无效 |
| 500    | 服务器内部错误 | 数据库连接失败       |

---

## 8. 数据埋点需求

### 8.1 页面访问埋点

| 埋点位置 | 埋点事件           | 埋点参数           | 用途           |
| -------- | ------------------ | ------------------ | -------------- |
| 首页     | page_view          | user_id, timestamp | 统计PV/UV      |
| 登录页   | login_page_view    | user_id, referrer  | 统计登录页访问 |
| 注册页   | register_page_view | user_id, referrer  | 统计注册页访问 |

### 8.2 用户行为埋点

| 埋点位置   | 埋点事件           | 埋点参数                   | 用途             |
| ---------- | ------------------ | -------------------------- | ---------------- |
| 注册按钮   | register_click     | button_name, page_position | 统计注册转化率   |
| 登录按钮   | login_click        | button_name, page_position | 统计登录转化率   |
| 绑定OJ按钮 | bind_oj_click      | platform, button_name      | 统计绑定转化率   |
| 排行榜切换 | leaderboard_switch | from_platform, to_platform | 统计使用偏好     |
| 卡片翻转   | card_flip          | platform, action           | 统计功能使用情况 |

### 8.3 业务埋点

| 埋点事件        | 埋点参数                       | 用途             |
| --------------- | ------------------------------ | ---------------- |
| user_register   | user_id, org_id, register_time | 分析用户注册趋势 |
| user_login      | user_id, login_time, login_ip  | 分析用户活跃度   |
| oj_bind_success | user_id, platform, identifier  | 分析OJ平台分布   |
| oj_bind_fail    | user_id, platform, error_code  | 分析绑定失败原因 |

---

## 9. 测试验收标准

### 9.1 功能测试

#### 用户认证模块

| 测试项    | 测试场景   | 预期结果              |
| --------- | ---------- | --------------------- |
| 用户注册  | 正常注册   | 注册成功，自动登录    |
| 用户注册  | 手机号重复 | 提示"手机号已注册"    |
| 用户注册  | 验证码错误 | 提示"验证码错误"      |
| 用户登录  | 正常登录   | 登录成功，返回Token   |
| 用户登录  | 密码错误   | 提示"密码错误"        |
| Token刷新 | Token正常  | 刷新成功，返回新Token |
| Token刷新 | Token过期  | 返回reload: true      |

#### OJ账号绑定模块

| 测试项   | 测试场景   | 预期结果               |
| -------- | ---------- | ---------------------- |
| 绑定洛谷 | 正常ID     | 绑定成功，返回用户数据 |
| 绑定洛谷 | 不存在的ID | 提示"ID无效"           |
| 绑定力扣 | 正常ID     | 绑定成功，返回用户数据 |
| 绑定力扣 | 不存在的ID | 提示"ID无效"           |

#### 排行榜模块

| 测试项     | 测试场景 | 预期结果       |
| ---------- | -------- | -------------- |
| 排行榜展示 | 有数据   | 显示前60%用户  |
| 排行榜展示 | 无数据   | 显示"暂无数据" |
| 排行榜切换 | 点击卡片 | 正反切换成功   |

### 9.2 性能测试

| 测试项   | 测试方法       | 验收标准          |
| -------- | -------------- | ----------------- |
| 首页加载 | Lighthouse测试 | Performance ≥90分 |
| API响应  | Apache Bench   | P95 ≤500ms        |
| 并发用户 | JMeter压测     | 支持500并发       |

### 9.3 安全测试

| 测试项   | 测试方法     | 验收标准       |
| -------- | ------------ | -------------- |
| SQL注入  | 输入SQL语句  | 被过滤，无报错 |
| XSS攻击  | 输入脚本标签 | 被转义，不执行 |
| CSRF攻击 | 伪造跨站请求 | 被拦截         |
| 密码加密 | 查看数据库   | 密码哈希存储   |

### 9.4 兼容性测试

| 浏览器  | 版本 | 测试项     | 验收标准 |
| ------- | ---- | ---------- | -------- |
| Chrome  | 90+  | 功能、样式 | 正常     |
| Edge    | 90+  | 功能、样式 | 正常     |
| Safari  | 14+  | 功能、样式 | 正常     |
| Firefox | 88+  | 功能、样式 | 正常     |

---

## 10. 上线计划

### 10.1 开发排期

| 阶段         | 任务             | 工期     | 负责人     | 交付物    |
| ------------ | ---------------- | -------- | ---------- | --------- |
| **需求阶段** | 需求评审、UI设计 | 3天      | 产品、设计 | PRD、UI稿 |
| **开发阶段** | 前端开发         | 7天      | 前端       | 前端代码  |
|              | 后端开发         | 7天      | 后端       | 后端代码  |
|              | 联调测试         | 3天      | 全员       | 测试报告  |
| **测试阶段** | 功能测试         | 2天      | 测试       | Bug列表   |
|              | 性能测试         | 1天      | 测试       | 性能报告  |
|              | 安全测试         | 1天      | 测试       | 安全报告  |
| **上线阶段** | 部署上线         | 1天      | 运维       | 线上环境  |
| **合计**     |                  | **25天** |            |           |

### 10.2 里程碑

| 里程碑       | 时间 | 标志           |
| ------------ | ---- | -------------- |
| M1: 需求冻结 | D+3  | PRD评审通过    |
| M2: 设计完成 | D+6  | UI设计稿确认   |
| M3: 开发完成 | D+16 | 前后端联调通过 |
| M4: 测试完成 | D+20 | Bug修复完成    |
| M5: 正式上线 | D+25 | 生产环境可用   |

### 10.3 上线检查清单

#### 上线前检查

- [ ] 所有P0/P1功能测试通过
- [ ] 性能测试达标（首页≤2s，API≤500ms）
- [ ] 安全测试无高危漏洞
- [ ] 日志系统正常工作
- [ ] 监控告警配置完成
- [ ] 数据备份策略确认
- [ ] 回滚方案准备完毕

#### 上线后验证

- [ ] 核心功能可用（注册、登录、绑定、排行榜）
- [ ] 数据准确性验证（OJ数据获取正确）
- [ ] 性能监控正常（无异常告警）
- [ ] 用户反馈渠道畅通

---

## 11. 风险评估与应对

### 11.1 技术风险

| 风险项         | 风险等级 | 影响         | 应对措施                                                          |
| -------------- | -------- | ------------ | ----------------------------------------------------------------- |
| **OJ平台反爬** | 高       | 数据获取失败 | 1. 使用代理IP池<br>2. 限制爬取频率<br>3. 准备备用方案（手动导入） |
| **并发性能**   | 中       | 响应慢、超时 | 1. Redis缓存<br>2. 数据库索引优化<br>3. 应用层限流                |
| **数据安全**   | 高       | 用户数据泄露 | 1. 全站HTTPS<br>2. 密码加密存储<br>3. 定期安全审计                |

### 11.2 业务风险

| 风险项           | 风险等级 | 影响       | 应对措施                                              |
| ---------------- | -------- | ---------- | ----------------------------------------------------- |
| **用户留存率低** | 中       | 产品失败   | 1. 提升视觉体验<br>2. 增加社交功能<br>3. 引入激励机制 |
| **OJ平台关闭**   | 低       | 功能不可用 | 1. 支持多平台<br>2. 允许手动录入数据                  |

### 11.3 时间风险

| 风险项       | 风险等级 | 影响     | 应对措施                                                          |
| ------------ | -------- | -------- | ----------------------------------------------------------------- |
| **开发延期** | 中       | 上线推迟 | 1. 功能分级（P0/P1/P2）<br>2. 预留缓冲时间<br>3. 必要时削减P2功能 |
| **联调问题** | 中       | 集成失败 | 1. 提前定义接口<br>2. Mock数据先行<br>3. 每日站会同步             |

---

## 附录

### 附录A: 术语表

| 术语     | 全称                          | 解释           |
| -------- | ----------------------------- | -------------- |
| OJ       | Online Judge                  | 在线判题系统   |
| JWT      | JSON Web Token                | 一种认证令牌   |
| PRD      | Product Requirements Document | 产品需求文档   |
| MVP      | Minimum Viable Product        | 最小可行产品   |
| P0/P1/P2 | Priority 0/1/2                | 优先级等级     |
| MoSCoW   | Must/Should/Could/Won't       | 优先级分级方法 |

### 附录B: 参考文档

- [RFC 6749: OAuth 2.0](https://tools.ietf.org/html/rfc6749)
- [RFC 7519: JSON Web Token (JWT)](https://tools.ietf.org/html/rfc7519)
- [OWASP Top 10](https://owasp.org/www-project-top-ten/)
- [Web Content Accessibility Guidelines (WCAG)](https://www.w3.org/WAI/WCAG21/quickref/)

### 附录C: 联系方式

| 角色       | 姓名     | 邮箱 | 电话 |
| ---------- | -------- | ---- | ---- |
| 产品经理   | [待填写] | -    | -    |
| 技术负责人 | [待填写] | -    | -    |
| UI设计师   | [待填写] | -    | -    |
| 测试负责人 | [待填写] | -    | -    |

---

**文档结束**

_本文档为内部保密资料，禁止外传_
