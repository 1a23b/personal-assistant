# 需求定义阶段文档

## 个人助手 - v1.0

---

## 📋 文档信息

| 项目         | 内容                                   |
| ------------ | -------------------------------------- |
| **文档类型** | 需求定义阶段文档                       |
| **产品名称** | 个人助手                               |
| **文档版本** | v1.0.0                                 |
| **创建日期** | 2025-01-18                             |
| **对应阶段** | 需求定义阶段（Requirement Definition） |

---

## 📌 目录

1. [用户角色定义](#1-用户角色定义)
2. [用户故事（User Stories）](#2-用户故事user-stories)
3. [功能分级（MoSCoW Method）](#3-功能分级moscow-method)
4. [用户故事地图](#4-用户故事地图)
5. [功能依赖关系图](#5-功能依赖关系图)
6. [需求追溯矩阵](#6-需求追溯矩阵)

---

## 1. 用户角色定义

### 1.1 角色建模

基于对目标用户群体的调研，我们定义了以下用户角色：

#### 角色1：学生（Student）

**基本信息**：

- **年龄**：18-22岁
- **身份**：高校计算机专业学生
- **技术水平**：具备基本编程能力，熟悉1-2门编程语言
- **使用场景**：日常刷题练习、课程作业、算法竞赛准备

**核心诉求**：

- 了解自己的刷题进度和排名
- 与同学进行良性竞争
- 获得成就感和激励

**痛点**：

- 不知道自己在班级中的水平
- 缺乏学习动力和目标
- 无法直观看到自己的进步

**使用频率**：高（每天2-3次）

---

#### 角色2：教师/管理员（Teacher/Admin）

**基本信息**：

- **年龄**：30-45岁
- **身份**：高校教师、培训机构讲师
- **技术水平**：熟悉编程，有一定管理经验
- **使用场景**：布置作业、检查进度、数据分析

**核心诉求**：

- 快速了解全班学习进度
- 发现学习困难的学生
- 评估教学效果
- 督促学生算法学习

**痛点**：

- 手动记录和管理成本高
- 无法实时掌握学生进度
- 缺乏数据支撑的教学决策

**使用频率**：中（每天1次）

> **注**：V1.0版本暂不实现教师端功能，在V2.0中规划

---

### 1.2 用户画像（Persona）

#### 学生用户 - 张三

```
姓名：张三
年龄：20岁
学校：某某大学计算机系
年级：大二
专业：计算机科学与技术

技术背景：
- 熟悉Python、C++
- 在洛谷平台做了200道题
- 在力扣平台做了50道题

刷题习惯：
- 每天晚上刷1-2小时题
- 喜欢做动态规划和图论题
- 偶尔会查看排行榜

期望：
- 能够看到自己在班级的排名
- 了解自己和同学的差距
- 通过排名激励自己继续刷题

痛点：
- 不知道班级其他同学刷了多少题
- 缺乏竞争氛围，学习动力不足
- 无法量化自己的进步
```

---

## 2. 用户故事（User Stories）

### 2.1 用户故事格式

每个用户故事遵循标准格式：

```
作为一名 <角色>
我希望 <功能>
以便于 <价值>

验收标准（Acceptance Criteria）：
  Given（前置条件）
  When（操作步骤）
  Then（预期结果）
```

---

### 2.2 用户认证模块用户故事

#### US-001: 用户注册

**用户故事**：

> 作为一个新学生
> 我希望能够通过手机号注册账号
> 以便于我开始使用这个平台

**优先级**：P0（必须有）

**验收标准**：

```
Scenario 1: 正常注册
  Given 我访问注册页面
  And 我没有注册过账号
  When 我输入用户名"张三"
  And 我输入手机号"13800138000"
  And 我输入密码"pass1234"
  And 我输入6位验证码
  And 我点击"注册"按钮
  Then 注册成功
  And 手动登录系统
  And 跳转到主页
  And 收到JWT Token

Scenario 2: 手机号重复
  Given 我访问注册页面
  And 手机号"13800138000"已被注册
  When 我输入相同的手机号
  And 我输入其他信息
  And 我点击"注册"按钮
  Then 注册失败
  And 提示"手机号已注册"

Scenario 3: 验证码错误
  Given 我访问注册页面
  When 我输入所有信息
  And 我输入错误的验证码
  And 我点击"注册"按钮
  Then 注册失败
  And 提示"验证码错误"
  And 验证码刷新

Scenario 4: 密码格式错误
  Given 我访问注册页面
  When 我输入所有信息
  And 我输入密码"123"（少于8位）
  And 我点击"注册"按钮
  Then 注册失败
  And 提示"密码长度必须为8-16位"
```

**业务规则**：

- 用户名：必填，最大20位
- 手机号：必填，11位，全局唯一
- 密码：必填，8-16位，必须包含字母和数字
- 验证码：必填，6位数字，有效期5分钟
- 组织ID：可选，用于加入组织

**数据字段**：

```typescript
interface RegisterRequest {
  username: string; // 用户名
  password: string; // 密码
  phone: string; // 手机号
  captcha: string; // 验证码
  captcha_id: string; // 验证码ID
  org_id?: number; // 组织ID（可选）
}
```

---

#### US-002: 用户登录

**用户故事**：

> 作为一个已注册的学生
> 我希望能够使用手机号和密码登录
> 以便于我进入平台查看排行榜

**优先级**：P0（必须有）

**验收标准**：

```
Scenario 1: 正常登录
  Given 我已注册账号
  And 手机号为"13800138000"
  And 密码为"pass1234"
  When 我访问登录页面
  And 我输入手机号和密码
  And 我输入正确的验证码
  And 我点击"登录"按钮
  Then 登录成功
  And 跳转到主页
  And 收到JWT Token
  And 收到RefreshToken（Cookie）

Scenario 2: 密码错误
  Given 我已注册账号
  When 我输入正确的手机号
  And 我输入错误的密码
  And 我点击"登录"按钮
  Then 登录失败
  And 提示"密码错误"
  And 连续错误5次后锁定账号30分钟

Scenario 3: 账号不存在
  Given 我访问登录页面
  When 我输入未注册的手机号
  And 我点击"登录"按钮
  Then 登录失败
  And 提示"账号不存在"

Scenario 4: Token刷新
  Given 我已登录
  And AccessToken已过期（2小时后）
  When 我访问需要认证的接口
  Then 系统自动调用刷新接口
  And 返回新的AccessToken
  And 用户无感知
```

**业务规则**：

- 手机号：必填，11位
- 密码：必填，8-16位
- 验证码：必填，6位数字
- AccessToken有效期：2小时
- RefreshToken有效期：7天
- 密码错误超过5次：账号锁定30分钟

**数据字段**：

```typescript
interface LoginRequest {
  phone: string; // 手机号
  password: string; // 密码
  captcha: string; // 验证码
  captcha_id: string; // 验证码ID
}

interface LoginResponse {
  user: User; // 用户信息
  access_token: string; // 访问令牌
  access_token_expires_at: number; // 过期时间（毫秒）
}
```

---

#### US-003: 用户登出

**用户故事**：

> 作为一个已登录的学生
> 我希望能够退出登录
> 以便于保护我的账号安全

**优先级**：P0（必须有）

**验收标准**：

```
Scenario 1: 正常登出
  Given 我已登录
  When 我点击顶部用户图标
  And 我点击"退出登录"按钮
  Then 登出成功
  And 清除本地Token
  And 清除服务端登录状态
  And RefreshToken加入黑名单
  And 跳转到登录页
```

**业务规则**：

- 清除Redis中的登录状态
- 将RefreshToken加入黑名单
- 清除客户端Cookie

---

#### US-004: 获取验证码

**用户故事**：

> 作为一个用户
> 我希望能够获取图形验证码
> 以便于防止机器人恶意注册

**优先级**：P0（必须有）

**验收标准**：

```
Scenario 1: 获取验证码
  Given 我访问注册或登录页面
  When 页面加载完成
  Then 自动显示图形验证码
  And 验证码为6位数字
  And 验证码图片清晰可辨认
  And 返回验证码ID

Scenario 2: 验证码刷新
  Given 我看到验证码
  When 我点击验证码图片
  Then 验证码刷新
  And 生成新的验证码ID
```

**业务规则**：

- 验证码：6位数字
- 有效期：5分钟
- 存储位置：内存（Redis）
- 使用后自动销毁

---

### 2.3 OJ账号绑定模块用户故事

#### US-005: 绑定洛谷账号

**用户故事**：

> 作为一个学生
> 我希望能够绑定我的洛谷账号
> 以便于系统自动获取我的刷题数据

**优先级**：P1（应该有）

**验收标准**：

```
Scenario 1: 成功绑定洛谷账号
  Given 我已登录
  And 我还没有绑定洛谷账号
  When 我进入主页
  And 我在"洛谷卡片"输入框输入洛谷ID"123456"
  And 我点击"提交"按钮
  Then 系统验证ID有效性
  And 验证通过后
  And 卡片翻转到反面
  And 显示我的头像
  And 显示我的真实姓名
  And 显示我通过的题目数量
  And 显示简单/中等/困难题目数量

Scenario 2: ID不存在
  Given 我已登录
  When 我输入不存在的洛谷ID"999999"
  And 我点击"提交"按钮
  Then 绑定失败
  And 提示"ID无效，请检查后重试"
  And 卡片不翻转

Scenario 3: 网络超时
  Given 我已登录
  When 我输入洛谷ID
  And 我点击"提交"按钮
  And 后端爬虫请求超时（>10秒）
  Then 绑定失败
  And 提示"服务繁忙，请稍后重试"
  And 卡片不翻转

Scenario 4: 修改已绑定的ID
  Given 我已绑定洛谷ID"123456"
  And 卡片处于反面状态
  When 我点击"修改"按钮
  Then 卡片翻转到正面
  And 输入框显示当前ID
  And 我可以修改ID
  And 重新提交后更新数据
```

**业务规则**：

- identifier必须是真实的洛谷用户ID
- 系统通过爬虫验证ID有效性
- 绑定成功后自动获取用户信息
- 同一用户同一平台只能绑定一次，重复绑定会覆盖
- 爬取超时时间：10秒

**数据字段**：

```typescript
interface BindOJRequest {
  platform: "luogu" | "leetcode"; // 平台名称
  identifier: string; // 用户ID
}

interface BindOJResponse {
  platform: string; // 平台名称
  identifier: string; // 用户ID
  real_name: string; // 真实姓名
  user_avatar: string; // 头像URL
  passed_number: number; // 通过题目数
  easy_number?: number; // 简单题数
  medium_number?: number; // 中等题数
  hard_number?: number; // 困难题数
  total_number?: number; // 总题目数
}
```

---

#### US-006: 绑定力扣账号

**用户故事**：

> 作为一个学生
> 我希望能够绑定我的力扣账号
> 以便于系统自动获取我的刷题数据

**优先级**：P1（应该有）

**验收标准**：

```
Scenario 1: 成功绑定力扣账号
  Given 我已登录
  And 我还没有绑定力扣账号
  When 我进入主页
  And 我在"力扣卡片"输入框输入力扣ID"user123"
  And 我点击"提交"按钮
  Then 系统验证ID有效性
  And 验证通过后
  And 卡片翻转到反面
  And 显示我的头像
  And 显示我的真实姓名
  And 显示我通过的题目数量
```

**验收标准**与US-005类似，只是平台不同。

---

### 2.4 排行榜模块用户故事

#### US-007: 查看洛谷排行榜

**用户故事**：

> 作为一个学生
> 我希望能够看到洛谷排行榜
> 以便于了解自己在班级中的排名

**优先级**：P1（应该有）

**验收标准**：

```
Scenario 1: 查看排行榜（有数据）
  Given 我已登录
  And 我已绑定洛谷账号
  And 组织内至少有1个学生绑定了洛谷
  When 我进入主页
  And 我查看右侧排行榜卡片
  Then 显示洛谷排行榜
  And 排行榜按通过题目数降序排列
  And 只显示前60%的学生
  And 每个学生显示：排名、头像、真实姓名、通过题目数
  And 我的排名高亮显示

Scenario 2: 查看排行榜（无数据）
  Given 我已登录
  And 我还没有绑定洛谷账号
  When 我查看排行榜卡片
  Then 提示"请先绑定洛谷账号才能查看排行榜"

Scenario 3: 排行榜为空
  Given 我已登录
  And 我已绑定洛谷账号
  And 组织内没有其他学生绑定洛谷
  When 我查看排行榜卡片
  Then 显示"暂无排行数据"

Scenario 4: 切换到力扣排行榜
  Given 我正在查看洛谷排行榜
  When 我点击排行榜卡片
  Then 卡片翻转到反面
  And 显示力扣排行榜
```

**业务规则**：

- 排序规则：按通过题目数降序
- 展示范围：前60%用户
- 展示字段：排名、头像、真实姓名、通过题目数
- 当前用户排名高亮
- 未绑定时显示提示信息

---

#### US-008: 查看个人数据卡片

**用户故事**：

> 作为一个学生
> 我希望能够查看我的个人刷题数据
> 以便于了解我的学习进度

**优先级**：P1（应该有）

**验收标准**：

```
Scenario 1: 查看洛谷个人数据
  Given 我已登录
  And 我已绑定洛谷账号
  When 我进入主页
  And 我查看左上角"洛谷卡片"
  Then 卡片处于反面状态
  And 显示我的头像（80×80px，圆形）
  And 显示我的真实姓名
  And 显示我通过的题目总数
  And 显示简单/中等/困难题目数量

Scenario 2: 卡片翻转动画
  Given 我的洛谷卡片处于正面状态
  When 我提交洛谷ID成功
  Then 卡片执行3D翻转动画
  And 动画时长600ms
  And 使用ease-in-out缓动函数
  And 翻转到反面显示个人数据

Scenario 3: 修改洛谷ID
  Given 我的洛谷卡片处于反面状态
  When 我点击"修改"按钮
  Then 卡片翻转到正面
  And 输入框显示当前ID
  And 我可以修改ID
```

---

### 2.5 组织管理模块用户故事

#### US-009: 查看组织列表

**用户故事**：

> 作为一个注册学生
> 我希望能够查看可用的组织列表
> 以便于我选择加入合适的组织

**优先级**：P2（可以有）

**验收标准**：

```
Scenario 1: 查看组织列表（分页）
  Given 我访问注册页面
  When 我点击"选择组织"下拉框
  Then 显示组织列表
  And 每页显示10个组织
  And 显示组织名称和描述
  And 我可以翻页查看更多

Scenario 2: 查看组织列表（全部）
  Given 我访问注册页面
  When 我不传page参数
  Then 显示所有组织

Scenario 3: 搜索组织
  Given 我访问注册页面
  When 我输入"清华"
  Then 显示名称包含"清华"的组织
```

**业务规则**：

- 支持分页查询
- 默认每页10条
- page=0时返回全部
- 仅显示公开组织

---

## 3. 功能分级（MoSCoW Method）

### 3.1 MoSCoW优先级法则

```
Must have（必须有）   - P0：核心功能，不做就无法上线
Should have（应该有）  - P1：重要功能，显著提升用户体验
Could have（可以有）  - P2：锦上添花的功能，有时间就做
Won't have（本次不做）- P3：明确不在本次版本范围
```

---

### 3.2 功能分级表

#### P0：必须有（Must Have）

| 功能ID   | 功能名称   | 功能描述                   | 不做的影响   |
| -------- | ---------- | -------------------------- | ------------ |
| **F001** | 用户注册   | 新用户通过手机号注册账号   | 无法获取用户 |
| **F002** | 用户登录   | 已注册用户通过手机号登录   | 无法使用系统 |
| **F003** | 验证码生成 | 生成图形验证码，防止机器人 | 存在安全风险 |
| **F004** | Token刷新  | AccessToken过期后自动刷新  | 用户体验极差 |
| **F005** | 用户登出   | 用户主动退出登录           | 无法安全退出 |

**合计**：5个功能模块

**开发排期**：Week 1-2（必须100%完成）

---

#### P1：应该有（Should Have）

| 功能ID   | 功能名称     | 功能描述                         | 价值         |
| -------- | ------------ | -------------------------------- | ------------ |
| **F101** | 绑定洛谷账号 | 用户绑定洛谷ID，自动获取刷题数据 | 核心业务功能 |
| **F102** | 绑定力扣账号 | 用户绑定力扣ID，自动获取刷题数据 | 核心业务功能 |
| **F103** | 个人数据卡片 | 展示用户在洛谷/力扣的个人数据    | 核心展示功能 |
| **F104** | 洛谷排行榜   | 展示组织的洛谷刷题排行榜         | 核心展示功能 |
| **F105** | 力扣排行榜   | 展示组织的力扣刷题排行榜         | 核心展示功能 |
| **F106** | 卡片翻转动画 | 绑定成功后卡片自动翻转           | 提升体验     |

**合计**：6个功能模块

**开发排期**：Week 2-3（至少完成80%）

---

#### P2：可以有（Could Have）

| 功能ID   | 功能名称     | 功能描述                   | 价值       |
| -------- | ------------ | -------------------------- | ---------- |
| **F201** | 组织列表查询 | 用户注册时查看可加入的组织 | 辅助功能   |
| **F202** | 排行榜搜索   | 在排行榜中搜索特定用户     | 便利性提升 |
| **F203** | 刷新排行榜   | 手动刷新排行榜数据         | 便利性提升 |
| **F204** | 数据统计图表 | 用图表展示刷题趋势         | 可视化增强 |

**合计**：4个功能模块

**开发排期**：Week 4（时间充裕则做）

---

#### P3：本次不做（Won't Have - V2.0规划）

| 功能ID   | 功能名称   | 功能描述               | 规划版本 |
| -------- | ---------- | ---------------------- | -------- |
| **F301** | 管理员后台 | 教师管理学生、查看数据 | V2.0     |
| **F302** | 作业布置   | 教师布置算法作业       | V2.0     |
| **F303** | 进度检查   | 自动检查作业完成情况   | V2.0     |
| **F304** | 移动端适配 | 支持手机和平板访问     | V2.0     |
| **F305** | 社交功能   | 学生之间交流讨论       | V2.0     |
| **F306** | 成就系统   | 勋章、等级、积分       | V2.0     |
| **F307** | 数据导出   | 导出学习报告           | V2.0     |

**合计**：7个功能模块

**规划版本**：V2.0（3个月后）

---

### 3.3 功能分级决策依据

#### 决策维度1：用户价值

```
高价值（必须做）：
  ✓ 用户认证（无法使用）
  ✓ OJ绑定（核心功能）
  ✓ 排行榜（核心价值）

中价值（应该做）：
  ✓ 个人数据卡片（增强体验）
  ✓ 卡片翻转动画（视觉体验）

低价值（可以做）：
  ○ 组织查询（辅助功能）
  ○ 搜索功能（便利性）
```

#### 决策维度2：技术复杂度

```
低复杂度（优先做）：
  ✓ 用户认证（成熟方案）
  ✓ OJ绑定（爬虫技术）
  ✓ 排行榜（简单查询）

中复杂度（排期做）：
  ○ 卡片翻转（CSS动画）
  ○ 数据统计（聚合计算）

高复杂度（暂不做）：
  ○ 实时通知（WebSocket）
  ○ 数据分析（算法模型）
```

#### 决策维度3：依赖关系

```
依赖链：
  用户注册 → 用户登录 → OJ绑定 → 排行榜展示

关键路径：
  P0功能 → P1功能 → P2功能

决策：
  必须先完成P0，才能做P1
  P1完成后，考虑P2
  P3放到V2.0
```

---

## 4. 用户故事地图

### 4.1 用户故事地图（User Story Mapping）

将用户故事按照用户使用流程排列，形成故事地图：

```
┌─────────────────────────────────────────────────────────────┐
│                        目标：刷题进度管理                      │
└─────────────────────────────────────────────────────────────┘

【阶段1：发现与注册】
├── 访问平台
├── 查看轮播图
├── 了解平台功能
└── 注册账号（US-001）★ P0

【阶段2：登录认证】
├── 获取验证码（US-004）★ P0
├── 输入手机号密码
├── 提交登录
├── 接收Token
└── 进入主页（US-002）★ P0

【阶段3：绑定OJ账号】
├── 查看个人卡片
├── 输入洛谷ID
├── 绑定洛谷账号（US-005）★ P1
├── 输入力扣ID
├── 绑定力扣账号（US-006）★ P1
└── 查看个人数据（US-008）★ P1

【阶段4：查看排行榜】
├── 查看洛谷排行榜（US-007）★ P1
├── 查看力扣排行榜（US-007）★ P1
├── 切换排行榜
└── 对比自己排名

【阶段5：持续使用】
├── 每日登录（US-002）★ P0
├── 查看排名变化
├── 刷题后查看更新
├── 修改绑定ID（US-005）★ P1
└── 退出登录（US-003）★ P0

【阶段6：辅助功能】
├── 选择组织（US-009）☆ P2
└── 查看组织列表

图例：★ 必须实现 | ☆ 可选实现
```

---

### 4.2 最小可行产品（MVP）范围

**MVP定义**：

> 能够验证核心价值、让用户完成核心流程的最小功能集合

**本项目的MVP范围**：

```
✓ 必须包含（P0）：
  - 用户注册、登录、登出
  - 验证码生成
  - Token刷新

✓ 核心功能（P1）：
  - 绑定洛谷账号
  - 个人数据卡片
  - 洛谷排行榜

✗ 暂不包含（P2/P3）：
  - 组织管理
  - 力扣绑定（可先支持洛谷）
  - 管理员后台
```

**MVP上线标准**：

- 用户能够注册登录
- 用户能够绑定洛谷账号
- 用户能够查看排行榜
- 系统稳定运行

---

## 5. 功能依赖关系图

### 5.1 功能依赖矩阵

| 功能              | F001注册 | F002登录 | F004刷新 | F005洛谷 | F007排行 | F009组织 |
| ----------------- | -------- | -------- | -------- | -------- | -------- | -------- |
| **F001 注册**     | -        | -        | -        | -        | -        | ○        |
| **F002 登录**     | ●        | -        | -        | -        | -        | -        |
| **F003 验证码**   | ●        | ●        | -        | -        | -        | -        |
| **F004 刷新**     | ●        | ●        | -        | -        | -        | -        |
| **F005 洛谷**     | ●        | ●        | ●        | -        | -        | -        |
| **F006 力扣**     | ●        | ●        | ●        | ○        | -        | -        |
| **F007 排行榜**   | ●        | ●        | ●        | ●        | -        | -        |
| **F008 个人卡片** | ●        | ●        | ●        | ●        | ○        | -        |
| **F009 组织**     | ○        | -        | -        | -        | -        | -        |

图例：● 强依赖 | ○ 弱依赖 | - 无依赖

---

### 5.2 依赖关系说明

#### 强依赖关系（必须先完成）

```
1. 注册 → 登录 → 刷新Token
   必须先能注册，才能登录；登录后才能刷新

2. 登录 → 绑定OJ
   必须先登录，才能绑定OJ账号

3. 绑定OJ → 排行榜
   必须先绑定OJ，才能显示排行榜

4. 绑定OJ → 个人卡片
   必须先绑定OJ，才能显示个人数据
```

#### 弱依赖关系（可选）

```
1. 注册 → 选择组织
   注册时可以选择加入组织，也可以不加

2. 个人卡片 → 排行榜
   个人数据和排行榜相对独立
```

---

### 5.3 开发顺序建议

基于依赖关系，建议的开发顺序：

```
第1周（P0功能）：
  Day 1-2: 验证码生成（F003）
  Day 3-4: 用户注册（F001）
  Day 5-7: 用户登录 + Token刷新（F002 + F004）

第2周（P1功能）：
  Day 1-3: 绑定洛谷账号（F005）
  Day 4-5: 个人数据卡片（F008）
  Day 6-7: 洛谷排行榜（F007）

第3周（P1/P2功能）：
  Day 1-2: 绑定力扣账号（F006）
  Day 3-4: 力扣排行榜（F007）
  Day 5-7: 组织列表查询（F009）+ 联调测试

第4周（测试优化）：
  Day 1-3: 全面测试
  Day 4-5: Bug修复
  Day 6-7: 性能优化 + 上线准备
```

---

## 6. 需求追溯矩阵

### 6.1 需求追溯表

将用户需求、功能、技术实现关联起来：

| 用户需求ID | 用户故事   | 功能ID | 接口路径            | 前端组件        | 优先级 |
| ---------- | ---------- | ------ | ------------------- | --------------- | ------ |
| **US-001** | 用户注册   | F001   | POST /user/register | RegisterForm    | P0     |
| **US-002** | 用户登录   | F002   | POST /user/login    | LoginForm       | P0     |
| **US-003** | 用户登出   | F005   | POST /user/logout   | Header          | P0     |
| **US-004** | 获取验证码 | F003   | POST /base/captcha  | CaptchaImage    | P0     |
| **US-005** | 绑定洛谷   | F101   | POST /oj/bind       | LuoguCard       | P1     |
| **US-006** | 绑定力扣   | F102   | POST /oj/bind       | LeetCodeCard    | P1     |
| **US-007** | 查看排行榜 | F104   | GET /org/list       | LeaderboardCard | P1     |
| **US-008** | 个人数据   | F103   | GET /oj/list        | PersonalCard    | P1     |
| **US-009** | 组织列表   | F201   | GET /org/list       | OrgSelector     | P2     |

---

### 6.2 需求覆盖率检查

#### 用户需求覆盖率

```
✓ 已覆盖（100%）：
  - 用户注册登录
  - OJ账号绑定
  - 排行榜查看
  - 个人数据展示
  - 组织管理

✗ 未覆盖（0%）：
  - （暂无）
```

#### 功能需求覆盖率

```
✓ 已定义（100%）：
  - 9个核心用户故事
  - 15个功能模块
  - 8个后端接口
  - 7个前端组件
```

---

### 6.3 验收标准追溯

每个用户故事都有明确的验收标准：

| 用户故事        | 验收场景数 | 已定义 | 测试用例数 |
| --------------- | ---------- | ------ | ---------- |
| US-001 注册     | 4          | ✓      | 8          |
| US-002 登录     | 4          | ✓      | 10         |
| US-003 登出     | 1          | ✓      | 3          |
| US-004 验证码   | 2          | ✓      | 4          |
| US-005 洛谷     | 4          | ✓      | 8          |
| US-006 力扣     | 1          | ✓      | 4          |
| US-007 排行榜   | 4          | ✓      | 10         |
| US-008 个人卡片 | 3          | ✓      | 6          |
| US-009 组织     | 3          | ✓      | 6          |

**合计**：30个验收场景，59个测试用例

---

## 7. 需求优先级调整机制

### 7.1 优先级调整触发条件

以下情况可能触发优先级调整：

```
1. 技术风险：
   - 某功能技术难度超出预期
   - 第三方API不稳定
   - 性能瓶颈无法解决

2. 业务变化：
   - 竞品发布新功能
   - 用户调研发现新需求
   - 商业目标调整

3. 资源变化：
   - 开发人员变动
   - 时间截止提前
   - 预算削减
```

---

### 7.2 优先级调整流程

```
1. 提出调整建议
   ↓
2. 评估影响范围
   - 对用户价值的影响
   - 对技术实现的影响
   - 对排期的影响
   ↓
3. 产品、技术、测试三方评审
   ↓
4. 更新需求文档
   ↓
5. 通知所有相关人员
   ↓
6. 调整开发排期
```

---

### 7.3 优先级调整示例

**示例1：OJ平台反爬限制**

```
原计划：
  P1: 绑定洛谷 + 绑定力扣

问题：
  力扣反爬严格，爬虫开发耗时过长

调整方案：
  P1: 绑定洛谷（核心用户在洛谷）
  P2: 绑定力扣（延后实现）

影响：
  - 用户价值：轻微下降（大多数学生在洛谷）
  - 开发时间：节省3天
  - 技术风险：降低
```

**示例2：Token刷新复杂度高**

```
原计划：
  P0: AccessToken + RefreshToken双Token机制

问题：
  RefreshToken黑名单机制复杂，开发耗时2天

调整方案：
  P0: 单Token（延长有效期到7天）
  P1: 双Token机制（V1.1版本）

影响：
  - 安全性：轻微下降（可接受）
  - 用户体验：无感知
  - 开发时间：节省2天
```

---

## 8. 需求变更管理

### 8.1 需求变更流程

```
1. 提出变更申请
   - 描述变更原因
   - 说明变更内容
   - 评估变更影响
   ↓
2. 变更评审会议
   - 产品、技术、测试、UI参与
   - 讨论变更必要性
   - 评估变更成本
   ↓
3. 决策
   - 接受变更
   - 拒绝变更
   - 延后变更
   ↓
4. 更新文档
   - 更新PRD
   - 更新用户故事
   - 更新功能分级
   ↓
5. 通知团队
   - 邮件通知
   - 站会同步
   - 更新排期
```

---

### 8.2 需求变更影响评估

变更申请需要评估以下维度：

```
1. 功能影响：
   - 影响哪些功能
   - 是否破坏已有功能
   - 是否引入新的依赖

2. 技术影响：
   - 是否需要重构代码
   - 是否需要引入新技术
   - 是否影响性能

3. 排期影响：
   - 增加多少开发时间
   - 是否影响其他功能
   - 是否需要调整上线日期

4. 成本影响：
   - 开发成本
   - 测试成本
   - 运维成本
```

---

### 8.3 需求变更记录表

| 变更ID | 变更日期   | 变更内容       | 变更原因   | 影响范围   | 决策结果         |
| ------ | ---------- | -------------- | ---------- | ---------- | ---------------- |
| CR-001 | 2025-01-20 | 增加邮箱验证码 | 安全要求高 | F001       | 接受             |
| CR-002 | 2025-01-25 | 取消力扣绑定   | 技术难度大 | F102, F107 | 拒绝，延后到V2.0 |

---

## 9. 附录

### 9.1 用户故事编号规则

```
格式：US-XXX

US: User Story（用户故事）
XXX: 三位数字编号（001-999）

编号分配：
  001-099: 用户认证模块
  100-199: OJ账号绑定模块
  200-299: 排行榜模块
  300-399: 组织管理模块
  400-499: 个人中心模块
  500-599: 管理员模块
```

---

### 9.2 功能编号规则

```
格式：FXXX

F: Function（功能）
XXX: 三位数字编号

编号分配：
  001-099: P0（必须有）
  100-199: P1（应该有）
  200-299: P2（可以有）
  300-399: P3（本次不做）
```

---

### 9.3 验收标准模板

```gherkin
Feature: [功能名称]

  Scenario: [场景名称]
    Given [前置条件]
    And [前置条件]
    When [操作步骤]
    And [操作步骤]
    Then [预期结果]
    And [预期结果]
```

---

### 9.4 相关文档

- 《产品需求文档（PRD）》：requirement.md
- 《原始需求文档》：t.md
- 《接口文档》：t.md（第7章）
- 《技术架构设计》：待补充
- 《UI设计稿》：待补充

---

## 10. 总结

本文档完成了需求定义阶段的核心工作：

✅ **用户角色定义**

- 定义了2个核心用户角色（学生、教师）
- 创建了详细的用户画像

✅ **用户故事**

- 编写了9个核心用户故事
- 每个故事包含完整的验收标准
- 覆盖了所有P0/P1/P2功能

✅ **功能分级**

- 使用MoSCoW方法进行优先级划分
- P0: 5个功能
- P1: 6个功能
- P2: 4个功能
- P3: 7个功能（V2.0）

✅ **用户故事地图**

- 按用户使用流程排列
- 明确了MVP范围

✅ **功能依赖关系**

- 分析了功能间的依赖
- 给出了开发顺序建议

✅ **需求追溯**

- 建立了需求追溯矩阵
- 确保需求100%覆盖

---

**下一步工作**：

1. 进入设计阶段（交互设计、UI设计）
2. 技术架构设计
3. 制定开发排期
4. 启动开发工作

---

**文档结束**
